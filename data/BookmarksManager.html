<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<script type="text/javascript">
    
    var id_index = 0;
	var arrLocalizeStrings = [];
	var jsObject = [];
	
	arrLocalizeStrings.push("Remove");
	arrLocalizeStrings.push("Up");
	arrLocalizeStrings.push("Down");
   
   function init_table()
   {
		var jsonRequesLocalizeStrings = JSON.stringify(arrLocalizeStrings);
		
		document.documentElement.addEventListener("SendBookMarks", function(event) {
        //window.alert(event.detail);
		
			var tbl = document.getElementById("table_Bookmarks");
			var tblBody = document.getElementById("tbody_Bookmarks");
			var message = JSON.parse(event.detail);
			var jsObject = message.bookmarks;
			var jsLocalizeStrings = message.arrLocalizeStrings;
			
			arrLocalizeStrings = [];
			arrLocalizeStrings = jsLocalizeStrings;
			
			for (var i = 0; i < jsObject.length; i++)
			{
				// creates a table row
				var row = document.createElement("tr");
				
				row.id = "id_row_" + id_index;
			   
				var cell = document.createElement("td");
				var cellText = document.createElement("input");
				cellText.type = "text";
				cellText.size=70;
				cellText.readonly = true;
				cellText.disabled= true;
				cellText.value = jsObject[i].label;  
				cell.appendChild(cellText);
				row.appendChild(cell);
				
				/*
				var cell = document.createElement("td");
				var cellText = document.createElement("input");
				cellText.type = "text";
				cellText.size=40;
				cellText.readonly = true;
				cellText.disabled= true;
				cellText.value = jsObject[i].url;            
				cell.appendChild(cellText);
				row.appendChild(cell);
				*/
				
				
				/*
				var cell = document.createElement("td");
				var cellImage = document.createElement("input");
				cellImage.type = "image";
				cellImage.src = "edit.png";
				cellImage.id = "id_edit_" + id_index;
				cellImage.name="ShowToolTip"; 
				cellImage.title=arrLocalizeStrings[0];
				cellImage.addEventListener('mouseover', onShowToolTip, false);
				cellImage.onclick = function(event){doEdit(event);};
				cell.appendChild(cellImage);
				row.appendChild(cell);
				*/
				
				var cell = document.createElement("td");
				var cellImage = document.createElement("input");
				cellImage.type = "image";
				cellImage.src = "delete.png";
				cellImage.id = "id_del_" + id_index;
				cellImage.name="ShowToolTip"; 
				cellImage.title=arrLocalizeStrings[0];
				cellImage.addEventListener('mouseover', onShowToolTip, false);
				cellImage.onclick = function(event){doDelete(event);};
				cell.appendChild(cellImage);
				row.appendChild(cell);
				
				var cell = document.createElement("td");
				var cellImage = document.createElement("input");
				cellImage.type = "image";
				cellImage.src = "upup.png";
				cellImage.id = "id_upup_" + id_index;
				cellImage.name="ShowToolTip"; 
				cellImage.title=arrLocalizeStrings[1];
				cellImage.addEventListener('mouseover', onShowToolTip, false);
				cellImage.onclick = function(event){doUpUp(event);};
				cell.appendChild(cellImage);
				row.appendChild(cell);
				
				var cell = document.createElement("td");
				var cellImage = document.createElement("input");
				cellImage.type = "image";
				cellImage.src = "up.png";
				cellImage.id = "id_up_" + id_index;
				cellImage.name="ShowToolTip"; 
				cellImage.title=arrLocalizeStrings[1];
				cellImage.addEventListener('mouseover', onShowToolTip, false);
				cellImage.onclick = function(event){doUp(event);};
				cell.appendChild(cellImage);
				row.appendChild(cell);
				
				var cell = document.createElement("td");
				var cellImage = document.createElement("input");
				cellImage.type = "image";
				cellImage.src = "down.png";
				cellImage.id = "id_down_" + id_index;
				cellImage.name="ShowToolTip"; 
				cellImage.title=arrLocalizeStrings[2];
				cellImage.addEventListener('mouseover', onShowToolTip, false);
				cellImage.onclick = function(event){doDown(event);};
				cell.appendChild(cellImage);
				row.appendChild(cell);
				
				var cell = document.createElement("td");
				var cellImage = document.createElement("input");
				cellImage.type = "image";
				cellImage.src = "downdown.png";
				cellImage.id = "id_downdown_" + id_index;
				cellImage.name="ShowToolTip"; 
				cellImage.title=arrLocalizeStrings[2];
				cellImage.addEventListener('mouseover', onShowToolTip, false);
				cellImage.onclick = function(event){doDownDown(event);};
				cell.appendChild(cellImage);
				row.appendChild(cell);
			   
			   // add the row to the end of the table body
				tblBody.appendChild(row);
				
				id_index++;
			}
        
		}, false);
      
        var event = document.createEvent('CustomEvent');
        event.initCustomEvent("RequesBookMarks", true, true, jsonRequesLocalizeStrings);
        document.documentElement.dispatchEvent(event);
        
        var elements = document.getElementsByName("ShowToolTip");

        for (var i = 0; i < elements.length; i++) 
        {
            elements[i].addEventListener('mouseover', onShowToolTip, false);
        }
   }
   
   function doRemoveAll()
   {
       var tblBody = document.getElementById("tbody_Bookmarks");
       var results = evaluateXPath(tblBody, "//tr");
      
       for (var i = results.length - 1; i >= 0; i--)
       {
            results[i].parentNode.removeChild(results[i]);
       }
   }
   
   function doUp(evt)
   {
		var id = evt.currentTarget.id;
       
		id =id.replace("id_up_", "id_row_");
	   
		var  node = document.getElementById(id);
		var  parentNode = node.parentNode;
	   
		if (node && parentNode) 
        {
			var nextSibling = node.nextSibling;
			var previousSibling = node.previousSibling;
			
			if (previousSibling)
			{
				previousSibling.previousSibling = node;
				previousSibling.nextSibling = nextSibling;
				
				node.nextSibling = previousSibling;
				node.previousSibling = previousSibling.previousSibling;
				
				if (previousSibling.previousSibling)
				{
					previousSibling.nextSibling = node;
				}
			}
			
			if (nextSibling)
			{
				nextSibling.previousSibling = previousSibling;
			}
        }
	   
	   /*
	   element.firstChild
element.lastChild
element.childNodes
element.nextSibling
element.previousSibling
	   */
   }
   
   function doUpUp(evt)
   {
       var id = evt.currentTarget.id;
       
       id =id.replace("id_upup_", "id_row_");
   }
   
   function doDown(evt)
   {
       var id = evt.currentTarget.id;
       
       id =id.replace("id_del_", "id_row_");
   }
   
   function doDownDown(evt)
   {
       var id = evt.currentTarget.id;
       
       id =id.replace("id_del_", "id_row_");
   }
   
   function doDelete(evt)
   {
       //window.alert(evt);
       
       var id = evt.currentTarget.id;
       
       id =id.replace("id_del_", "id_row_");
       
        var  node = document.getElementById(id);
       
        if (node && node.parentNode) 
        {
             node.parentNode.removeChild(node);
        }
   }
   
    // Evaluate an XPath expression aExpression against a given DOM node
    // or Document object (aNode), returning the results as an array
    // thanks wanderingstan at morethanwarm dot mail dot com for the
    // initial work.
    function evaluateXPath(aNode, aExpr) {
      var xpe = new XPathEvaluator();
      var nsResolver = xpe.createNSResolver(aNode.ownerDocument == null ?
        aNode.documentElement : aNode.ownerDocument.documentElement);
      var result = xpe.evaluate(aExpr, aNode, nsResolver, 0, null);
      var found = [];
      var res;
      while (res = result.iterateNext())
        found.push(res);
      return found;
    }
   
   function doSave()
   {
       var tblBody = document.getElementById("tbody_Bookmarks");
       var results = evaluateXPath(tblBody, "//tr/td/input");
	   var jsObjectNew = [];
       
       for (var i = 0; i < results.length; i = i + 4)
       {
			var id = results[i].id;
		   
			id = id.replace("id_del_", "id_row_");
           
			jsObjectNew.push(jsObject[id]);
       }
       	   
       var jsonString = JSON.stringify(listData);
        
       var event = document.createEvent('CustomEvent');
       event.initCustomEvent("StoreData", true, true, jsonString);
       document.documentElement.dispatchEvent(event);
   }
   
   function onShowToolTip(element) {
   
        var event = document.createEvent('CustomEvent');
        event.initCustomEvent("ShowToolTip", true, true, element.currentTarget.title);
        document.documentElement.dispatchEvent(event);
    
    }

    

</script>

</head>
 
<body onload="init_table();">
<h4 data-l10n-id="Title_Page_id">Bookmarks Manager</h4>
<input type="image" name="ShowToolTip" title="Remove all items" src="delete.png" onclick="doRemoveAll()">
<input type="image" name="ShowToolTip" title="Save all items in storage" src="save.png" onclick="doSave()"/><br />
<table id="table_Bookmarks" border="0"><tbody id="tbody_Bookmarks"></tbody></table> 
</body>
</html>